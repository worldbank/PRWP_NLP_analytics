<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>WB Policy Research Race Chart</title>
    <!-- libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css" integrity="sha512-P5MgMn1jBN01asBgU0z60Qk4QxiXo86+wlFahKrsQf37c9cro517WzVSPPV1tDKzhku2iJ2FVgL67wG03SGnNA==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vue-slider-component@latest/theme/default.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js" integrity="sha512-XKa9Hemdy1Ui3KSGgJdgMyYlUg1gM+QhL6cnlyTe2qzMCYm4nAZ1PsVerQzTTXzonUR+dmswHqgJPuwCq1MaAg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.0.1/echarts.min.js" integrity="sha512-vMD/IRB4/cFDdU2MrTwKXOLmIJ1ULs18mzmMIWLCNYg/nZZkCdjBX+UPrtQdkleuuf0YaqXssaKk8ZXOpHo3qg==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-slider-component@latest/dist/vue-slider-component.umd.min.js"></script>

</head>
<body>

<!-- layout -->
<div id = 'main' class="container p-1 border">

    <!-- Main filters -->
    <div class="d-flex justify-content-between mt-2 mx-2 py-2 border">
        <!-- Top N -->
        <div class="form-inline">
            <label for="topN" class="ml-3">Top</label>
            <select id="topN" class="form-select mx-1" v-model="topN">
                <option v-for="n in getNumbers(5,30,5)" :value="n">{{n}}</option>
            </select>
            <span>countries</span>
        </div>
        <!-- Year -->
        <div class="col col-9 form-inline">
            <span>Year ({{selectedYearRange[0]}} - {{selectedYearRange[1]}})</span>
            <vue-slider class="col ml-3" v-model="selectedYearRange" :min="minYear" :max="maxYear" :lazy="false" @change="onFilterChange()"></vue-slider>
        </div>
        <!-- Button -->
        <div class="col col-1 align-self-center">
            <button class="btn btn-primary btn-sm btn-block" @click="onButtonClick()">{{buttonText}}</button>
        </div>
    </div>

    <!-- Chart -->
    <div class="row gx-3 mx-1 mb-2">
        <div class="col-12">
            <div class="pt-3" id="chart" style="width:100%;height:700px"></div>
        </div>
    </div>

</div>


<script type="text/javascript">
    let updateFrequency = 1300;
    const defaultMinYear = 1988;
    const defaultMaxYear = 2022;
    const statYears = [1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022]
    const statRegions = ['EAP', 'SAR', 'LAC', 'AFR', 'ECA', 'MNA', 'OTH']
    const chartColors = ["#62496F", "#F4CE4B", "#3F6F76", "#C65840", "#69B7CE", "#6EAF45", "#CBB396"];
    // const chartColors = ["#CBB396", "#555234", "#86AA7D", "#4D280F", "#42819F", "#C26B61", "#DE7944"];
    // const chartColors = ["#C26B61", "#DE7944", "#6EAF45", "#F38400", "#629FCB", "#EA5E5F", "#FFD19D", "#F38400", "#C6ADD5"];
    const PolicyResearchStat = [
        ['CHN','China','EAP',327,766,1201,1824,2554,3316,3813,4699,5467,6632,7218,8055,8776,10037,10959,12981,14224,16652,18782,22747,25494,28166,31477,33716,36634,39861,41702,49099,51429,52460,54651,57181,59624,61629,61860],
        ['IND','India','SAR',405,1429,3054,3795,4871,5575,5980,6539,7334,7760,8808,9874,10802,11770,12376,13509,14771,16475,17945,21160,22600,25075,27009,28631,31509,35204,37639,45738,48008,49965,52638,54550,57215,59177,59201],
        ['MEX','Mexico','LAC',673,1651,2996,3972,5570,6953,7594,8298,8743,9172,10438,11182,12113,13614,14465,15329,16613,18302,19531,20831,22253,23336,24350,25198,26152,27258,28359,30903,31922,32782,33724,35141,36074,36859,36942],
        ['BRA','Brazil','LAC',668,1802,2688,3870,5014,5562,6136,6531,6999,7315,7747,8450,9179,10252,10936,12081,13701,15316,16319,17561,18756,19739,20711,21823,22894,24427,25334,29550,30467,31123,32142,33033,33817,34952,35021],
        ['IDN','Indonesia','EAP',462,1298,1868,2420,3182,3653,4107,4871,6385,6814,7593,8410,8984,9542,10006,10661,11080,11922,12452,13232,13952,14556,15266,16206,17171,17911,18557,22087,22914,23426,24213,24962,25650,26303,26322],
        ['ARG','Argentina','LAC',183,1047,1668,2344,2910,3539,3870,4250,4653,5332,5893,6841,7573,8701,9419,11039,12077,13081,13792,14433,15444,15763,16426,16906,17404,17958,18433,20581,21222,21489,22021,22329,22709,23107,23159],
        ['CHL','Chile','LAC',198,968,1676,2735,3464,4002,4638,5213,5604,6390,6996,7503,8435,9339,10000,10692,11313,11922,12622,13484,14567,15130,16103,16663,17030,17663,18371,19295,19722,20245,20962,21402,21863,22380,22454],
        ['BGD','Bangladesh','SAR',233,539,751,1231,1676,1819,2051,2186,2553,2662,2768,3176,3416,3517,3683,4035,4343,4946,5510,5824,6279,6790,7505,8015,8889,9704,10660,13663,14382,15264,16102,17497,18221,19093,19101],
        ['GHA','Ghana','AFR',300,1047,1902,2752,3159,3585,4050,4227,4371,4867,5104,5444,5816,6105,6500,6747,6889,7325,7739,8331,9037,9540,10034,11037,11538,12116,12551,14779,15612,16312,17163,18065,18581,18928,18938],
        ['KEN','Kenya','AFR',336,1050,1375,1885,2245,2585,2888,3018,3129,3227,3396,3676,3929,4023,4164,4307,4715,5085,5561,6026,6538,7200,7737,8931,9540,10129,11004,13338,14486,14982,16058,17111,17666,18218,18243],
        ['COL','Colombia','LAC',293,1127,1572,2119,2672,2959,3192,3683,3864,4150,4414,4773,5105,5534,5931,6271,6732,7322,7947,8566,9543,9875,10364,10844,11523,12084,12557,14356,14825,15126,15690,16379,17033,17996,18050],
        ['RUS','Russia','ECA',3,8,9,20,178,563,1187,1652,2029,2299,2662,3199,3997,4589,5186,5905,6398,7122,7982,8661,9143,9492,10602,11016,11941,12575,13114,14306,15404,15696,16346,16973,17521,17828,17875],
        ['VNM','Vietnam','EAP',14,72,82,108,139,192,279,405,478,579,777,1250,1735,2338,3748,4551,4850,5416,5866,6509,7131,7548,8012,8280,8741,9760,10123,12667,13904,14490,15347,16083,17051,17535,17547],
        ['PAK','Pakistan','SAR',221,797,1111,1681,2150,2377,2665,3077,3346,3665,3983,4208,4487,4818,4991,5132,5349,5724,6303,6699,7051,7441,7769,8294,8693,9526,10024,12705,12966,13625,14289,15124,15792,16292,16320],
        ['TZA','Tanzania','AFR',221,475,643,1065,1212,1452,1747,1842,2059,2166,2260,2442,2612,2865,3002,3162,3399,3822,4278,4702,5249,5715,6376,7172,8167,8628,9619,11923,12744,13348,13881,14663,15486,16072,16155],
        ['NGA','Nigeria','AFR',405,968,1340,1768,2078,2397,2737,2890,3332,3630,3727,3879,3992,4178,4299,4408,4559,4862,5052,5437,5677,6232,6620,7476,7718,8139,8798,11551,12144,12716,13441,13937,14656,15633,15752],
        ['UGA','Uganda','AFR',76,204,265,406,502,720,957,1290,1377,1454,1597,1804,2250,2376,2724,3046,3508,3841,4457,4802,5164,5747,6189,6853,7523,7996,8994,11091,11870,12594,13540,14386,14941,15693,15704],
        ['TUR','Turkey','ECA',394,1071,1599,1943,2676,2881,3036,3279,3606,3816,3983,4486,4743,4976,5101,5326,5658,6007,6642,6975,7270,7680,8219,8587,9036,9786,10579,12211,13055,13312,13885,14316,14940,15160,15207],
        ['ETH','Ethiopia','AFR',115,329,415,578,686,742,793,1038,1095,1143,1189,1313,1390,1456,1544,1761,1858,2299,2447,2928,3279,3864,4173,4896,5194,5725,6396,9090,10150,10882,11631,12801,13415,14910,15021],
        ['PHL','Philippines','EAP',389,951,1358,1709,2064,2326,2697,3062,3280,3457,3879,4346,4800,5128,5539,5961,6222,6621,6934,7513,7896,8334,8833,9253,9607,10073,10555,12509,12749,13027,13586,14255,14743,15007,15019],
        ['PER','Peru','LAC',220,784,1267,1497,1988,2169,2245,2354,2452,2763,2911,3220,3590,4034,4363,4619,5003,5378,5760,6130,6934,7288,7662,8341,8793,9565,10009,11541,12021,12472,12953,13556,13983,14685,14730],
        ['THA','Thailand','EAP',523,999,1566,1946,2254,2488,2691,2992,3398,3587,4224,5117,5585,6095,6591,7099,7307,7685,8205,8855,9269,9705,10180,10415,11175,11660,11954,12795,13068,13248,13638,13927,14167,14318,14331],
        ['ZAF','South Africa','AFR',36,112,162,250,320,362,408,569,636,682,838,1030,1318,1513,1744,2080,2435,2914,3689,4346,4986,5815,6398,7300,7907,8577,9063,9712,10449,10971,11652,12498,12878,13220,13243],
        ['POL','Poland','ECA',105,196,513,1407,2122,2805,3205,3899,4424,4786,5104,5414,6074,6602,6860,7128,7434,7953,8575,9007,9199,9605,10013,10407,10693,10971,11194,11736,11984,12166,12520,12779,12970,13084,13116],
        ['EGY','Egypt','MNA',189,372,675,1057,1465,1599,1677,1835,2150,2300,2503,2751,3060,3334,3575,3887,4012,4240,4429,4825,4995,5353,6141,6890,7362,7692,8066,9656,10053,10387,10818,11421,12027,12504,12528],
        ['MWI','Malawi','AFR',119,323,677,1091,1233,1310,1419,1485,1548,1578,1642,1709,1776,1837,1914,2052,2156,2341,2570,2754,3137,3752,4366,5148,5461,5967,6699,8223,8791,9582,10062,10431,11137,11984,12069],
        ['MYS','Malaysia','EAP',215,519,733,1219,1451,1789,2033,2480,2777,2903,3313,3997,4450,4847,5002,5378,5547,5848,6116,6540,6812,7199,7464,7679,8006,8595,8926,9375,9716,9984,10331,10706,11283,11494,11621],
        ['ZMB','Zambia','AFR',188,504,641,810,1054,1196,1537,1603,1658,1776,1852,1974,2135,2196,2423,2562,2676,2975,3327,3702,4118,4643,4865,5602,5877,6332,6612,7723,8029,8444,8734,9033,9318,9701,9708],
        ['MAR','Morocco','MNA',189,493,657,1185,1368,1560,1598,1706,1864,1945,2039,2139,2290,2388,2581,2817,2989,3342,3566,3831,4001,4336,4608,5074,5361,5631,5990,7592,7976,8287,8460,9080,9358,9589,9602],
        ['URY','Uruguay','LAC',130,463,714,959,1345,1614,1815,2197,2514,2774,3023,3604,3811,4076,4199,4388,4661,5084,5348,5623,5933,6122,6352,6563,6749,7076,7393,8119,8269,8427,8630,8816,8966,9132,9162],
        ['LKA','Sri Lanka','SAR',164,386,523,913,1042,1137,1250,1590,1661,1785,1856,2033,2156,2229,2358,2469,2581,2908,3159,3321,3580,3794,3972,4168,4630,5207,5473,7091,7370,7559,7990,8355,8773,8898,8904],
        ['SEN','Senegal','AFR',197,432,733,917,1026,1131,1276,1322,1381,1464,1526,1605,1744,1837,1985,2046,2188,2394,2494,2736,2961,3304,3601,4386,4555,4755,5028,6724,7008,7317,7525,7864,8325,8786,8796],
        ['NPL','Nepal','SAR',91,223,293,380,472,637,653,669,701,731,869,918,1014,1076,1215,1289,1340,1569,1656,1914,2195,2311,2401,2892,3167,3737,4147,6182,6643,6942,7594,8152,8424,8728,8730],
        ['BOL','Bolivia','LAC',163,419,557,784,1233,1397,1449,1523,1708,1871,1961,2176,2357,2735,2855,2990,3193,3428,3656,3936,4409,4681,4845,5229,5383,5618,5793,6857,7229,7393,7640,7822,7923,8130,8145],
        ['ECU','Ecuador','LAC',102,327,411,566,809,1051,1125,1184,1309,1560,1789,1919,2053,2382,2534,2758,2993,3255,3481,3843,4208,4425,4589,4852,4993,5358,5650,6349,6635,6794,6973,7298,7721,8010,8045],
        ['ROU','Romania','ECA',20,105,146,307,592,805,922,1002,1135,1196,1277,1389,1607,1785,1920,2130,2527,2756,3430,3827,3984,4210,4453,4746,5026,5441,5602,6537,6776,6939,7241,7442,7612,7747,7764],
        ['BGR','Bulgaria','ECA',22,60,79,347,728,903,1095,1360,1494,1633,1841,1888,2320,2492,2615,2922,3050,3253,4321,4754,4898,5144,5359,5675,5886,6091,6244,6657,6770,6987,7154,7293,7397,7536,7560],
        ['GTM','Guatemala','LAC',46,212,275,364,689,774,795,874,923,974,1036,1185,1290,1364,1460,2020,2363,2963,3206,3532,3938,4144,4328,4528,4772,5062,5327,6029,6285,6488,6701,6911,6998,7203,7230],
        ['MOZ','Mozambique','AFR',19,86,138,214,270,303,380,420,453,483,511,560,642,676,730,782,884,1117,1262,1442,1663,2234,2489,3245,3543,3804,4007,5562,5808,6030,6280,6563,6792,7216,7225],
        ['NER','Niger','AFR',80,224,313,435,511,581,665,697,739,782,823,855,925,976,1031,1084,1147,1505,1598,1838,1983,2252,2381,3150,3259,3511,3954,5288,5531,5694,5961,6343,6685,7044,7054],
        ['CMR','Cameroon','AFR',161,342,595,743,830,960,1064,1103,1167,1207,1314,1426,1561,1627,1717,1792,1959,2264,2560,2850,2997,3263,3664,4389,4550,4747,4916,5885,6106,6260,6423,6612,6731,6928,7023],
        ['RWA','Rwanda','AFR',60,175,232,327,463,531,608,657,694,713,753,790,847,868,887,939,1005,1192,1291,1476,1727,2094,2282,2788,3056,3362,3815,5124,5578,5786,6106,6486,6781,7016,7018],
        ['ZWE','Zimbabwe','AFR',63,553,698,1421,1637,1820,1926,2095,2155,2207,2312,2658,2783,2865,3045,3212,3324,3550,3757,4030,4192,4398,4500,5159,5313,5440,5624,5998,6195,6330,6457,6643,6791,6903,6915],
        ['TUN','Tunisia','MNA',114,350,483,689,889,1003,1035,1163,1328,1400,1453,1563,1639,1710,1803,1927,2011,2159,2317,2477,2567,2798,3031,3345,3499,3762,3956,5474,5900,6031,6136,6308,6653,6856,6863],
        ['CRI','Costa Rica','LAC',110,412,591,796,1011,1125,1164,1332,1418,1510,1571,1707,1775,2108,2208,2383,2509,2983,3254,3439,3646,3783,4028,4208,4461,4801,5012,5532,5784,5930,6110,6309,6519,6701,6732],
        ['MLI','Mali','AFR',65,185,302,541,622,704,778,812,845,884,936,983,1109,1164,1239,1292,1366,1523,1596,1740,1949,2140,2330,3097,3206,3558,3710,5049,5332,5515,5696,6053,6353,6727,6730],
        ['JOR','Jordan','MNA',170,286,359,469,548,597,671,787,881,944,989,1057,1124,1292,1430,1509,1616,1801,1952,2034,2110,2280,2511,2883,3201,3394,3634,4702,5027,5228,5473,5730,6109,6398,6406],
        ['VEN','Venezuela','LAC',91,323,462,672,983,1227,1463,1646,1771,1967,2096,2261,2400,2572,2992,3170,3414,3659,3880,4094,4312,4526,4665,4785,4905,5093,5265,5558,5682,5764,5881,5958,6105,6242,6267],
        ['BFA','Burkina Faso','AFR',50,155,227,313,375,422,478,512,553,632,672,733,789,966,1120,1221,1286,1417,1659,1852,1988,2254,2479,3035,3190,3425,3637,4871,5108,5239,5471,5732,5909,6185,6190],
        ['MDG','Madagascar','AFR',69,232,334,583,713,846,936,974,1028,1051,1092,1159,1211,1256,1364,1468,1625,1791,1999,2116,2342,2615,2842,3126,3241,3421,3586,4854,5133,5242,5374,5603,5754,5973,5976],
        ['NIC','Nicaragua','LAC',43,144,163,239,322,376,389,548,594,645,752,832,913,1011,1144,1308,1484,1808,2013,2275,2683,2860,3035,3245,3516,3780,4073,5008,5196,5337,5485,5643,5752,5897,5912],
        ['UKR','Ukraine','ECA',0,0,0,1,68,104,307,461,658,768,847,933,1068,1118,1287,1460,1534,1708,1915,2093,2180,2361,2748,3000,3229,3511,3673,4332,4556,4769,5023,5348,5644,5822,5831],
        ['HND','Honduras','LAC',46,259,302,391,539,651,667,739,785,838,867,972,1037,1113,1181,1337,1476,1768,1922,2236,2655,2868,3061,3182,3375,3551,3764,4697,4913,5093,5277,5415,5536,5670,5688],
        ['CIV',"Côte d'Ivoire",'AFR',293,543,827,1150,1323,1670,1788,1838,1905,1994,2081,2212,2358,2443,2576,2655,2711,2853,2949,3492,3615,3737,3814,4033,4109,4195,4296,5121,5240,5300,5351,5467,5553,5607,5613],
        ['SLV','El Salvador','LAC',62,207,241,320,431,464,478,618,672,733,787,956,1029,1117,1180,1362,1498,1728,1924,2186,2394,2564,2718,2914,3092,3343,3562,4069,4305,4406,4650,4809,5025,5207,5235],
        ['JAM','Jamaica','LAC',182,437,759,959,1118,1350,1393,1550,1614,1663,1771,1934,1993,2073,2129,2336,2423,2634,2795,3037,3152,3268,3345,3397,3486,3595,3697,4487,4595,4648,4701,4750,4832,4964,4974],
        ['BEN','Benin','AFR',54,149,203,296,361,398,468,492,541,564,608,661,728,795,875,917,974,1230,1292,1399,1511,1739,2012,2720,2877,2972,3116,4140,4258,4336,4539,4700,4795,4946,4967],
        ['SLE','Sierra Leone','AFR',134,258,300,387,446,468,539,585,614,628,656,696,738,783,810,841,869,989,1061,1155,1256,1518,1603,2072,2356,2549,2680,3701,3887,4038,4141,4387,4753,4905,4914],
        ['ALB','Albania','ECA',16,50,60,94,122,125,294,334,394,448,519,541,583,615,692,847,893,1036,1220,1466,1640,1912,2093,2369,2591,2681,2843,3823,3917,3987,4266,4620,4734,4882,4889],
        ['KHM','Cambodia','EAP',11,42,50,82,105,118,120,130,141,148,152,183,214,253,291,518,637,828,914,1118,1263,1467,1786,1901,2206,2441,2571,3322,3582,3856,4090,4521,4650,4845,4848],
        ['SDN','Sudan','AFR',73,312,375,528,957,1012,1094,1137,1181,1248,1274,1306,1340,1363,1397,1441,1480,1580,1656,1765,1949,2108,2210,3009,3117,3289,3400,3991,4127,4207,4293,4379,4496,4744,4746],
        ['GIN','Guinea','AFR',87,244,496,675,756,799,849,879,959,1024,1051,1100,1354,1413,1505,1559,1601,1701,1752,1898,2055,2292,2353,2562,2620,2730,2812,3829,3983,4076,4182,4343,4553,4686,4693],
        ['ARM','Armenia','ECA',0,0,0,2,54,122,132,149,212,252,278,323,365,538,618,749,812,966,1292,1360,1420,1516,1587,1997,2193,2358,2490,3525,3749,3877,4220,4377,4539,4688,4693],
        ['GEO','Georgia','ECA',0,1,2,6,57,88,118,180,255,296,305,374,482,637,731,842,902,1035,1296,1389,1506,1598,1692,1852,1983,2166,2334,3246,3511,3614,4066,4230,4497,4681,4688],
        ['LAO','Laos','EAP',31,84,107,172,215,232,234,254,273,293,314,352,388,458,489,694,743,856,903,1199,1293,1388,1468,1652,1858,2122,2489,3731,3838,3982,4176,4374,4507,4675,4677],
        ['YEM','Yemen','MNA',67,190,233,463,544,565,570,591,615,652,667,697,719,739,798,842,861,952,989,1070,1143,1244,1306,1599,1828,1985,2114,3729,3820,3919,4037,4241,4408,4500,4504],
        ['KAZ','Kazakhstan','ECA',0,0,0,1,47,68,96,168,250,306,342,396,806,914,1010,1076,1118,1255,1404,1734,1800,1877,2029,2137,2345,2556,2684,3400,3598,3693,3859,4190,4326,4407,4413],
        ['PAN','Panama','LAC',45,225,282,357,468,558,578,641,688,724,735,828,1010,1130,1203,1293,1395,1550,1676,1820,2068,2187,2296,2470,2726,2886,3086,3557,3791,3871,3960,4048,4272,4382,4391],
        ['MDA','Moldova','ECA',0,0,0,1,35,70,84,110,224,308,321,392,451,523,714,862,1130,1246,1544,1660,1763,1845,1920,2067,2215,2506,2611,3567,3628,3704,3867,4156,4243,4377,4380],
        ['HRV','Croatia','ECA',0,1,1,1,29,38,38,45,92,134,145,167,229,260,330,733,798,963,1171,1386,1481,1798,1977,2219,2362,2462,2679,3366,3423,3534,3688,3892,4191,4281,4290],
        ['AFG','Afghanistan','SAR',24,92,123,196,227,231,231,243,256,260,264,267,274,281,292,309,321,409,446,504,824,934,1000,1063,1302,1432,1557,3062,3163,3253,3641,3785,4020,4164,4196],
        ['LBR','Liberia','AFR',70,175,203,316,376,397,423,448,478,498,513,533,552,573,585,606,621,688,721,800,929,1012,1056,1483,1676,1926,2051,3019,3205,3331,3513,3693,3847,4141,4148],
        ['BWA','Botswana','AFR',104,208,263,384,474,501,538,556,587,640,664,705,746,790,830,946,978,1149,1313,1458,1688,1853,2170,2710,2836,3009,3134,3409,3662,3766,3867,3999,4065,4130,4131],
        ['TCD','Chad','AFR',59,180,259,353,403,428,474,500,560,614,641,669,728,752,820,865,928,1056,1128,1249,1481,1690,1828,2124,2223,2336,2468,3100,3247,3337,3397,3601,3796,3971,4070],
        ['TGO','Togo','AFR',69,220,335,485,564,625,716,745,777,798,837,879,926,966,1020,1097,1141,1264,1319,1421,1521,1681,2182,2349,2426,2563,2639,3291,3446,3534,3623,3795,3903,4053,4065],
        ['MUS','Mauritius','AFR',46,242,409,542,607,640,682,739,792,821,887,1022,1068,1140,1224,1409,1486,1615,1716,1817,2009,2201,2349,2539,2657,2803,2921,3383,3509,3566,3794,3908,3978,4038,4051],
        ['LSO','Lesotho','AFR',53,129,208,324,391,435,449,462,483,500,509,548,571,597,626,980,1035,1135,1358,1539,1633,1828,1969,2171,2307,2374,2461,3108,3250,3329,3551,3793,3883,3949,3954],
        ['HTI','Haiti','LAC',60,279,329,420,498,518,533,555,584,606,633,676,710,740,802,855,904,1011,1073,1383,1771,1864,2054,2194,2258,2297,2381,3376,3605,3693,3716,3774,3832,3915,3920],
        ['DOM','Dominican Republic','LAC',58,242,283,336,450,464,474,529,567,590,649,738,789,838,896,980,1207,1363,1469,1579,1675,1763,1990,2050,2215,2374,2554,3258,3375,3476,3588,3685,3770,3884,3900],
        ['MNG','Mongolia','EAP',20,53,54,77,218,249,266,282,342,425,576,599,624,655,713,799,826,939,986,1279,1324,1447,1571,1762,1905,2016,2119,2908,3015,3128,3360,3559,3696,3805,3814],
        ['PRY','Paraguay','LAC',51,187,215,294,413,457,474,508,569,634,680,782,836,910,967,1034,1108,1260,1424,1598,1820,1911,2013,2130,2205,2403,2541,3063,3184,3262,3372,3499,3561,3725,3761],
        ['BDI','Burundi','AFR',47,154,220,320,385,414,498,524,564,580,606,644,681,701,719,776,795,923,975,1081,1244,1347,1530,1708,1806,2105,2229,3108,3238,3317,3395,3561,3643,3748,3750],
        ['TJK','Tajikistan','ECA',0,0,0,0,39,56,59,64,117,147,159,185,203,217,254,302,341,452,602,668,819,922,1060,1223,1444,1643,1801,2620,2668,2727,2814,3090,3260,3386,3388],
        ['MRT','Mauritania','AFR',65,163,219,310,373,417,482,508,546,581,604,634,660,694,752,796,815,914,965,1109,1255,1416,1501,1600,1642,1707,2033,2809,2949,3019,3056,3173,3253,3339,3342],
        ['LBN','Lebanon','MNA',54,114,130,170,201,204,205,228,285,319,332,354,371,489,527,573,615,741,819,1003,1046,1189,1242,1507,1594,1678,1826,2449,2537,2679,2747,2896,3157,3275,3285],
        ['AZE','Azerbaijan','ECA',0,0,0,0,39,70,81,97,150,186,199,227,276,423,476,517,556,744,1003,1086,1142,1207,1291,1380,1541,1715,1791,2555,2663,2739,2917,3062,3189,3266,3271],
        ['DZA','Algeria','MNA',89,240,290,398,534,569,590,645,784,830,853,883,906,949,995,1041,1140,1280,1365,1437,1483,1648,1750,1910,1974,2132,2236,2686,2783,2874,2946,3047,3191,3252,3258],
        ['KGZ','Kyrgyzstan','ECA',0,0,0,0,35,42,55,66,129,183,266,315,391,454,506,573,613,709,850,931,967,1054,1112,1173,1273,1400,1514,2450,2525,2584,2725,3000,3141,3232,3233],
        ['IRN','Iran','MNA',41,149,172,248,302,334,358,372,429,468,493,525,549,616,729,776,824,937,999,1118,1224,1335,1410,1540,1650,1805,1886,2135,2522,2602,2697,2835,2992,3170,3175],
        ['GMB','Gambia','AFR',61,149,296,389,471,515,605,629,651,668,682,720,804,889,910,944,1016,1118,1167,1267,1346,1447,1520,1615,1659,1720,1765,2263,2368,2425,2523,2644,2779,3001,3005],
        ['MKD','North Macedonia','ECA',0,0,0,0,2,8,11,18,48,92,104,172,260,286,303,431,464,611,747,895,1138,1193,1327,1442,1562,1647,1758,2327,2370,2520,2591,2741,2851,2945,2951],
        ['BLR','Belarus','ECA',0,0,0,0,47,70,105,154,250,458,469,515,556,590,685,754,799,934,1098,1155,1210,1271,1323,1407,1597,1748,1840,2247,2410,2555,2612,2747,2823,2923,2927],
        ['IRQ','Iraq','MNA',39,98,109,166,201,209,213,233,259,287,293,297,313,329,338,359,374,446,490,580,623,675,697,816,929,1055,1181,1760,1911,2107,2222,2409,2661,2874,2883],
        ['UZB','Uzbekistan','ECA',0,0,0,0,43,62,79,99,177,221,242,277,615,666,719,834,917,1022,1177,1253,1308,1345,1380,1443,1541,1649,1691,2220,2263,2312,2364,2651,2717,2862,2864],
        ['AGO','Angola','AFR',19,78,152,223,263,275,305,343,367,389,433,466,510,535,552,586,629,706,756,877,954,1036,1089,1624,1698,1840,1904,2285,2421,2496,2563,2653,2754,2851,2857],
        ['SRB','Serbia','ECA',0,0,0,1,3,9,9,10,17,22,22,25,25,28,30,56,75,194,444,634,711,789,908,999,1210,1316,1426,2103,2162,2250,2482,2596,2761,2849,2856],
        ['PNG','Papua New Guinea','EAP',25,114,140,312,355,398,429,450,466,485,492,528,559,579,597,643,679,816,859,921,1010,1170,1272,1306,1347,1389,1470,2162,2195,2257,2362,2430,2472,2740,2740],
        ['SYR','Syria','MNA',53,123,155,221,268,285,303,331,386,436,453,481,495,510,543,567,599,688,737,792,823,918,977,1264,1361,1450,1596,1707,1807,1949,2199,2378,2475,2648,2651],
        ['NAM','Namibia','AFR',14,52,54,84,115,118,118,131,143,160,298,332,384,395,434,489,547,661,793,913,1023,1226,1351,1600,1674,1770,1890,2017,2153,2240,2311,2429,2526,2592,2601],
        ['GAB','Gabon','AFR',53,151,205,303,369,400,484,522,549,571,615,651,675,718,736,767,904,997,1053,1118,1214,1337,1448,1617,1670,1734,1795,2147,2255,2325,2396,2484,2544,2590,2597],
        ['COD','Congo - Kinshasa','AFR',143,350,547,738,1068,1121,1173,1213,1255,1286,1355,1391,1439,1457,1467,1479,1492,1563,1589,1655,1700,1806,1833,1950,1989,2031,2077,2125,2162,2222,2262,2317,2359,2415,2416],
        ['MMR','Myanmar (Burma)','EAP',60,102,130,178,192,209,219,237,259,285,289,310,355,378,393,439,452,542,565,637,695,754,769,797,863,901,987,1397,1522,1683,1812,1975,2163,2299,2302],
        ['COG','Congo - Brazzaville','AFR',1,1,1,1,1,1,1,2,2,2,15,31,46,53,65,80,90,177,219,270,341,434,487,1072,1140,1187,1306,1483,1629,1755,1862,1999,2161,2279,2280],
        ['SWZ','Eswatini','AFR',124,202,245,318,370,380,403,424,448,468,485,503,528,557,579,633,659,762,889,989,1076,1151,1215,1314,1424,1503,1598,1748,1904,1967,2048,2142,2194,2233,2239],
        ['DMA','Dominica','LAC',19,95,139,201,261,278,286,353,414,429,538,554,662,750,831,926,968,1082,1130,1196,1257,1342,1374,1422,1469,1519,1555,1866,1914,1952,2004,2036,2071,2114,2116],
        ['MNE','Montenegro','ECA',3,9,9,9,38,47,49,74,78,84,89,91,94,112,141,182,207,259,339,560,593,632,724,818,896,971,1101,1669,1710,1775,1852,1946,2034,2096,2099],
        ['BTN','Bhutan','SAR',25,68,70,124,156,168,169,181,190,198,202,207,219,231,241,278,292,384,412,459,496,518,539,601,704,824,888,1451,1545,1571,1703,1828,1897,2017,2021],
        ['SOM','Somalia','AFR',37,133,171,253,311,325,341,369,399,447,469,502,527,550,559,580,601,673,710,773,807,844,861,885,911,940,1000,1368,1431,1473,1520,1673,1740,1992,1992],
        ['GUY','Guyana','LAC',56,164,184,257,301,322,330,353,404,447,470,532,588,632,652,682,716,844,922,980,1092,1196,1227,1261,1309,1339,1382,1804,1837,1854,1874,1899,1933,1981,1983],
        ['CPV','Cape Verde','AFR',22,73,85,148,179,183,190,209,231,239,249,255,269,290,296,317,335,422,473,565,653,803,891,1205,1259,1303,1361,1704,1770,1808,1834,1891,1933,1959,1960],
        ['DJI','Djibouti','MNA',17,76,84,129,163,164,168,179,192,199,232,240,251,270,291,317,329,398,609,650,681,739,752,829,875,916,978,1488,1570,1626,1654,1770,1830,1920,1920],
        ['GNB','Guinea-Bissau','AFR',21,84,151,217,260,269,288,308,331,347,361,382,405,445,454,480,492,578,616,709,766,834,858,953,999,1052,1123,1571,1596,1627,1657,1725,1766,1857,1858],
        ['BIH','Bosnia & Herzegovina','ECA',0,0,0,0,2,3,3,3,3,23,23,24,24,34,34,101,157,246,305,422,464,515,596,650,705,757,833,1508,1537,1590,1622,1712,1782,1831,1834],
        ['TTO','Trinidad & Tobago','LAC',33,102,127,193,236,267,276,341,371,408,432,465,488,555,586,640,681,810,887,960,1008,1063,1103,1135,1181,1228,1296,1514,1559,1599,1643,1683,1710,1746,1751],
        ['CAF','Central African Republic','AFR',9,31,63,82,96,103,145,160,168,177,184,199,216,225,242,267,296,362,409,445,477,536,562,771,811,834,885,1328,1389,1418,1456,1534,1559,1599,1599],
        ['COM','Comoros','AFR',20,58,69,117,158,165,168,188,205,216,243,247,281,299,321,346,357,425,450,503,542,600,620,649,687,717,791,1172,1268,1299,1328,1426,1463,1589,1589],
        ['SSD','South Sudan','AFR',0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,7,7,8,447,470,497,513,955,1050,1082,1181,1329,1390,1573,1573],
        ['BLZ','Belize','LAC',19,82,104,128,165,168,173,294,330,352,359,375,393,420,440,472,503,591,647,698,737,811,830,865,901,939,1005,1280,1322,1345,1363,1400,1429,1474,1478],
        ['LBY','Libya','MNA',42,104,111,151,182,185,188,204,249,276,280,291,296,300,320,334,347,416,443,498,516,571,582,703,742,854,940,1022,1136,1166,1187,1223,1408,1454,1456],
        ['TON','Tonga','EAP',14,50,53,65,90,98,98,99,100,102,103,107,114,124,127,141,150,213,270,401,497,613,743,777,813,838,909,1203,1248,1261,1300,1317,1362,1388,1388],
        ['XKX','Kosovo','ECA',0,0,0,0,3,14,14,14,14,15,15,16,20,25,79,100,103,122,146,233,252,261,291,312,345,411,458,942,967,1007,1048,1118,1309,1345,1351],
        ['MDV','Maldives','SAR',17,43,49,63,86,100,101,105,117,125,130,136,147,160,167,196,204,287,311,348,404,434,446,466,550,599,641,962,975,991,1078,1109,1141,1184,1184],
        ['LCA','St. Lucia','LAC',38,104,122,152,193,196,197,218,235,241,252,258,282,312,316,337,351,421,448,480,494,533,549,563,579,603,631,1034,1069,1080,1090,1110,1127,1167,1170],
        ['FJI','Fiji','EAP',28,82,102,143,179,200,211,226,246,254,258,280,300,340,355,379,408,494,532,582,614,687,708,753,805,842,864,975,1005,1029,1045,1076,1135,1162,1164],
        ['GRD','Grenada','LAC',30,87,101,131,167,171,171,197,217,222,228,234,249,278,283,309,319,391,417,451,484,525,543,563,588,616,637,1013,1061,1068,1081,1096,1113,1136,1142],
        ['TKM','Turkmenistan','ECA',0,0,0,0,43,75,94,110,183,214,225,252,270,299,337,366,389,478,563,598,623,649,660,686,740,803,827,892,915,935,975,1049,1090,1117,1117],
        ['ERI','Eritrea','AFR',0,0,0,0,0,0,0,11,15,18,19,31,35,41,53,74,89,172,215,283,341,412,463,502,534,562,624,882,920,942,972,1010,1045,1092,1092],
        ['SYC','Seychelles','AFR',20,79,89,121,155,159,166,186,205,219,247,257,269,288,304,326,344,413,441,499,546,585,597,665,688,721,757,850,905,917,940,976,1010,1039,1041],
        ['VUT','Vanuatu','EAP',13,50,62,95,124,129,129,132,143,145,146,151,158,172,179,192,201,267,295,333,426,450,532,562,593,612,671,843,863,885,898,919,968,1002,1002],
        ['GNQ','Equatorial Guinea','AFR',14,46,52,97,119,135,141,160,170,177,187,197,212,225,233,250,263,335,372,414,557,620,643,707,725,744,770,854,882,895,908,936,973,994,995],
        ['WSM','Samoa','EAP',25,66,75,99,133,136,136,138,140,143,143,146,152,162,170,192,205,275,298,331,349,369,413,431,467,493,528,902,924,934,939,955,971,994,994],
        ['SLB','Solomon Islands','EAP',11,40,49,67,96,98,98,100,110,114,115,124,131,147,153,230,238,297,317,337,350,375,380,399,423,466,510,824,841,858,873,891,959,978,979],
        ['SUR','Suriname','LAC',11,61,75,116,151,155,160,176,197,206,210,213,224,232,242,255,274,358,385,422,444,479,498,520,537,551,569,696,719,738,759,791,807,860,860],
        ['STP','São Tomé & Príncipe','AFR',2,17,32,69,101,114,123,135,153,160,166,171,181,200,205,223,233,298,317,337,353,389,392,417,432,448,467,689,697,702,707,718,739,744,745],
        ['KIR','Kiribati','EAP',16,51,53,80,101,103,103,104,107,108,108,108,109,116,121,131,139,203,219,242,266,284,289,303,318,327,371,532,543,549,559,572,615,642,644],
        ['FSM','Micronesia (Federated States of)','EAP',17,44,44,84,122,122,122,123,135,135,135,135,139,145,146,156,161,234,252,273,292,308,370,389,401,410,435,497,514,521,527,540,561,571,571],
        ['ATG','Antigua & Barbuda','LAC',10,46,52,61,87,87,87,99,105,108,112,114,123,135,139,151,161,220,235,252,264,294,304,312,324,345,366,471,505,509,515,531,544,558,560],
        ['TLS','Timor-Leste','EAP',0,0,2,2,3,3,3,5,9,14,21,21,26,37,39,46,49,62,67,97,125,132,135,226,235,240,243,281,304,305,309,315,321,325,325],
        ['TUV','Tuvalu','EAP',6,17,17,26,28,28,28,29,29,31,31,31,31,35,37,41,41,51,60,74,91,103,109,116,121,125,158,244,249,252,262,270,311,321,321],
        ['MHL','Marshall Islands','EAP',0,0,0,0,2,2,2,2,2,2,2,2,4,9,10,21,26,99,113,134,147,161,162,170,177,183,201,268,275,277,280,291,312,320,320],
        ['PLW','Palau','EAP',0,0,0,2,4,5,6,6,6,6,6,6,6,11,12,15,21,76,84,96,109,122,124,136,145,150,169,195,208,211,215,221,230,239,239],
        ['NRU','Nauru','EAP',8,20,20,31,33,33,33,33,33,34,34,34,34,34,35,38,38,44,49,60,70,81,81,87,91,92,95,96,99,101,103,107,116,121,121],
        ['KNA','St. Kitts & Nevis','LAC',0,0,0,0,1,1,1,1,1,1,1,1,1,3,3,4,8,10,13,20,21,30,31,35,35,38,40,48,52,52,53,55,56,58,59],
        ['VCT','St. Vincent & Grenadines','LAC',0,1,1,1,1,1,1,4,4,4,4,4,5,5,5,5,9,11,15,18,19,28,29,30,31,33,35,45,47,47,48,50,50,54,54]
    ]
    let myChart = null;
    let chartData = [];

    new Vue({
        el: '#main',
        data: {
            topN: 20,
            selectedYearRange: [defaultMinYear, defaultMaxYear],
            minYear: defaultMinYear,
            maxYear: defaultMaxYear,
            buttonText: '⯈',
            isRunning: false
        },
        components: {
            'vueSlider': window[ 'vue-slider-component' ],
        },

        async mounted() {
            await this.loadVariableCodes();
            this.renderChart();
            this.runAnimation();
        },

        methods: {
            loadVariableCodes: async function() {
                this.minYear = Math.min(...statYears);
                this.maxYear = Math.max(...statYears);
                this.selectedYearRange = [defaultMinYear, defaultMaxYear];
            },

            loadMainData: async function() {
                // slice data
                chartData = [];
                PolicyResearchStat.forEach(countryData => {
                    chartData.push([
                        countryData[statYears.findIndex(y => y === this.selectedYearRange[0]) + 3],
                        countryData[1], // country name
                        countryData[0], // iso3code
                        countryData[2]  // region code
                    ]);
                });

                // update chart
                myChart.setOption({
                    title: [{
                        text: "Top " + this.topN + " countries covered in PRWP, 1988-2022",
                    }],
                    series: {
                        data: chartData,
                    },
                    graphic: {
                        elements: [
                            {
                                style: {
                                    text: this.selectedYearRange[0],
                                    font: 'bolder 80px monospace',
                                    fill: 'rgba(100, 100, 100, 0.25)'
                                },
                                z: 100
                            }
                        ]
                    },
                    yAxis: {
                        max: this.topN - 1
                    },
                    animationDurationUpdate: updateFrequency,
                });
            },

            runAnimation: async function() {
                for (let year=this.selectedYearRange[0]; year<=this.selectedYearRange[1]; year++) {
                    this.selectedYearRange = [year, this.selectedYearRange[1]];
                    await this.loadMainData();
                    await new Promise(r => setTimeout(r, updateFrequency));
                    updateFrequency = 1000 + (2030 - this.selectedYearRange[0])*30;
                    if (year !== this.selectedYearRange[0]) {
                        year = this.selectedYearRange[0];
                    }
                    if (this.isRunning === false) {
                        break;
                    }
                }
                this.isRunning = false;
                this.buttonText = '⯈';
                updateFrequency = 1000;
            },

            onButtonClick: function() {
                if (this.isRunning === true) {
                    this.isRunning = false;
                    this.buttonText = '⯈';
                } else {
                    if (this.selectedYearRange[0] === this.selectedYearRange[1]) {
                        this.selectedYearRange = [this.minYear, this.selectedYearRange[1]];
                    }
                    udateFrequency = 1000;
                    this.runAnimation();
                    this.isRunning = true;
                    this.buttonText = '❚❚';
                }
            },

            onFilterChange: async function() {
                this.loadMainData();
            },

            renderChart: function() {
                myChart = echarts.init(document.getElementById('chart'));
                option = {
                    title: [{
                        show: true,
                        text: "Top 20 countries covered in PRWP, 1988-2022",
                        textStyle: {
                            color: "#4d4d4d",
                            fontSize: "20",
                            lineHeight: 26
                        },
                        top: "0%",
                        x: "center"
                    }, {
                        show: true,
                        text: "Cumulative country counts for IDA/IBRD countries since 1988.",
                        textStyle: {
                            color: "#4d4d4d",
                            fontSize: "12",
                            fontWeight: "normal",
                            lineHeight: 10
                        },
                        left: 0,
                        bottom: 0
                    }],
                    grid: {
                        top: 50,
                        bottom: 100,
                        left: 150,
                        right: 80
                    },
                    xAxis: [{
                        max: 'dataMax',
                        axisLabel: {
                            formatter: function (n) {
                                return Math.round(n).toLocaleString('en') + '';
                            }
                        },
                        axisLine: {
                            show:false
                        }
                    },{
                        show: false
                    }],
                    yAxis: [{
                        type: 'category',
                        inverse: true,
                        max: 14,
                        axisLabel: {
                            show: true,
                            fontSize: 14,
                        },
                        animationDuration: 300,
                        animationDurationUpdate: 300
                    },{
                        show: false
                    }],
                    color: chartColors,
                    series: [
                        {
                            realtimeSort: true,
                            seriesLayoutBy: 'column',
                            type: 'bar',
                            itemStyle: {
                                color: function (param) {
                                    return chartColors[statRegions.findIndex(r => r === param.data[3]) % chartColors.length];
                                }
                            },
                            data: chartData,
                            label: {
                                show: true,
                                precision: 0,
                                position: 'right',
                                valueAnimation: true,
                                fontFamily: 'monospace',
                            }
                        },
                        {
                            name: 'EAP',
                            type: 'bar',
                            xAxisIndex: 1,
                            yAxisIndex: 1,
                            itemStyle: {
                                color: chartColors[0]
                            }
                        },
                        {
                            name: 'SAR',
                            type: 'bar',
                            xAxisIndex: 1,
                            yAxisIndex: 1,
                            itemStyle: {
                                color: chartColors[1]
                            }
                        },
                        {
                            name: 'LAC',
                            type: 'bar',
                            xAxisIndex: 1,
                            yAxisIndex: 1,
                            itemStyle: {
                                color: chartColors[2]
                            }
                        },
                        {
                            name: 'AFR',
                            type: 'bar',
                            xAxisIndex: 1,
                            yAxisIndex: 1,
                            itemStyle: {
                                color: chartColors[3]
                            }
                        },
                        {
                            name: 'ECA',
                            type: 'bar',
                            xAxisIndex: 1,
                            yAxisIndex: 1,
                            itemStyle: {
                                color: chartColors[4]
                            }
                        },
                        {
                            name: 'MNA',
                            type: 'bar',
                            xAxisIndex: 1,
                            yAxisIndex: 1,
                            itemStyle: {
                                color: chartColors[5]
                            }
                        },
                        {
                            name: 'OTH',
                            type: 'bar',
                            xAxisIndex: 1,
                            yAxisIndex: 1,
                            itemStyle: {
                                color: chartColors[6]
                            }
                        }
                    ],
                    legend: {
                        orient: 'horizontal',
                        left: 'center',
                        bottom: 30,
                        selectedMode: false,
                        data: statRegions
                    },
                    animationDuration: 0,
                    animationDurationUpdate: updateFrequency,
                    animationEasing: 'linear',
                    animationEasingUpdate: 'linear',
                    graphic: {
                        elements: [
                            {
                                type: 'text',
                                right: 160,
                                bottom: 100,
                                style: {
                                    text: this.selectedYearRange[0],
                                    font: 'bolder 80px monospace',
                                    fill: 'rgba(100, 100, 100, 0.25)'
                                },
                                z: 100
                            }
                        ]
                    }
                };
                myChart.setOption(option);
            },

            getNumbers:function(start,stop,step = 1) {
                return new Array(stop / step).fill(start).map((n,i)=>(i+1)*step);
            }
        }
    })

</script>
</body>
</html>
